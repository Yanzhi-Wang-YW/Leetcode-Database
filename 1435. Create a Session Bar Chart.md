```md
1435. Create a Session Bar Chart  
Table: Sessions

+---------------------+---------+
| Column Name         | Type    |
+---------------------+---------+
| session_id          | int     |
| duration            | int     |
+---------------------+---------+
session_id is the column of unique values for this table.
duration is the time in seconds that a user has visited the application.
 

You want to know how long a user visits your application. You decided to create bins of "[0-5>", "[5-10>", "[10-15>", and "15 minutes or more" and count the number of sessions on it.

Write a solution to report the (bin, total).

Return the result table in any order.

The result format is in the following example.

 

Example 1:

Input: 
Sessions table:
+-------------+---------------+
| session_id  | duration      |
+-------------+---------------+
| 1           | 30            |
| 2           | 199           |
| 3           | 299           |
| 4           | 580           |
| 5           | 1000          |
+-------------+---------------+
Output: 
+--------------+--------------+
| bin          | total        |
+--------------+--------------+
| [0-5>        | 3            |
| [5-10>       | 1            |
| [10-15>      | 0            |
| 15 or more   | 1            |
+--------------+--------------+
Explanation: 
For session_id 1, 2, and 3 have a duration greater or equal than 0 minutes and less than 5 minutes.
For session_id 4 has a duration greater or equal than 5 minutes and less than 10 minutes.
There is no session with a duration greater than or equal to 10 minutes and less than 15 minutes.
For session_id 5 has a duration greater than or equal to 15 minutes 
```  

## Master Table 
```py 
import pandas as pd

def create_bar_chart(sessions: pd.DataFrame) -> pd.DataFrame: 
    conditions = [
        (sessions['duration'] / 60 >= 0) & (sessions['duration'] / 60 < 5), 
        (sessions['duration'] / 60 >= 5) & (sessions['duration'] / 60 < 10), 
        (sessions['duration'] / 60 >= 10) & (sessions['duration'] / 60 < 15), 
        (sessions['duration'] / 60 >= 15)  
    ] 
    choices = ['[0-5>', '[5-10>', '[10-15>', '15 or more'] 
    sessions['bin'] = np.select(conditions, choices) 
    output = sessions.groupby('bin').agg(
        total=('session_id', 'count')
    ).reset_index() 
    mapping_table = pd.DataFrame({'bin': ['[0-5>', '[5-10>', '[10-15>', '15 or more']}) 
    output = mapping_table.merge(output, how='left', on='bin') 
    output = output.fillna(value=0)                
    return output 
```

Here is the step-by-step table flowchart with the corresponding Python code for the `create_bar_chart` function.

*(Note: The code uses `np.select` from the `numpy` library, so `import numpy as np` is required).*

### **Step 1: Load Input Data**
The `Sessions` table is loaded into memory.

**Python Code:**
```python
import numpy as np
# Assuming sessions DataFrame is already loaded as per the function input
# sessions = ...
```

**Table Output (`sessions`):**
| session_id | duration |
| :--- | :--- |
| 1 | 30 |
| 2 | 199 |
| 3 | 299 |
| 4 | 580 |
| 5 | 1000 |

---

### **Step 2: Categorize Duration into Bins**
The duration (in seconds) is converted to minutes (`duration / 60`). Using `np.select`, each session is assigned a `bin` label based on which condition it meets.

**Python Code:**
```python
conditions = [
    (sessions['duration'] / 60 >= 0) & (sessions['duration'] / 60 < 5), 
    (sessions['duration'] / 60 >= 5) & (sessions['duration'] / 60 < 10), 
    (sessions['duration'] / 60 >= 10) & (sessions['duration'] / 60 < 15), 
    (sessions['duration'] / 60 >= 15)  
] 
choices = ['[0-5>', '[5-10>', '[10-15>', '15 or more'] 
sessions['bin'] = np.select(conditions, choices)
```

**Table Output (`sessions`):**
*(Calculated Minutes: 0.5, 3.3, 4.98, 9.66, 16.66)*
| session_id | duration | **bin** |
| :--- | :--- | :--- |
| 1 | 30 | **[0-5>** |
| 2 | 199 | **[0-5>** |
| 3 | 299 | **[0-5>** |
| 4 | 580 | **[5-10>** |
| 5 | 1000 | **15 or more** |

---

### **Step 3: Count Sessions per Bin**
The data is grouped by the new `bin` column, and the number of sessions in each bin is counted.

**Python Code:**
```python
output = sessions.groupby('bin').agg(
    total=('session_id', 'count')
).reset_index()
```

**Table Output (`output`):**
*(Note: Bins with no sessions, like `[10-15>`, are missing)*
| bin | total |
| :--- | :--- |
| [0-5> | 3 |
| [5-10> | 1 |
| 15 or more | 1 |

---

### **Step 4: Ensure All Bins Exist**
A `mapping_table` is created with the standard list of bins. This table is merged with the aggregated counts using a Left Join. This ensures that even bins with zero counts appear in the final result.

**Python Code:**
```python
mapping_table = pd.DataFrame({'bin': ['[0-5>', '[5-10>', '[10-15>', '15 or more']}) 
output = mapping_table.merge(output, how='left', on='bin')
```

**Table Output (`output`):**
*(The bin `[10-15>` appears with `NaN` because it had no matches)*
| bin | total |
| :--- | :--- |
| [0-5> | 3 |
| [5-10> | 1 |
| [10-15> | NaN |
| 15 or more | 1 |

---

### **Step 5: Fill Missing Values**
Any `NaN` values (representing bins with 0 sessions) are replaced with `0`.

**Python Code:**
```python
output = output.fillna(value=0)
```

**Final Table Output (`output`):**
| bin | total |
| :--- | :--- |
| [0-5> | 3 |
| [5-10> | 1 |
| [10-15> | 0 |
| 15 or more | 1 |  


## pd.cut  
 ```py
import pandas as pd

def create_bar_chart(sessions: pd.DataFrame) -> pd.DataFrame: 
    # Define the bin edges and the corresponding labels
    bins = [0, 5, 10, 15, float('inf')]
    labels = ['[0-5>', '[5-10>', '[10-15>', '15 or more']
    
    # pd.cut automatically creates a Categorical Series. 
    # right=False ensures the intervals or buckets are [inclusive, exclusive)
    sessions['bin'] = pd.cut(sessions['duration'] / 60, bins=bins, labels=labels, right=False)
    
    # Group by the categorical bin. 
    # sessions["bin"].cat.categories 
    # Index(['[0-5>', '[5-10>', '[10-15>', '15 or more'], dtype='object')   
    # observed=False ensures empty bins are kept in the output with a count of 0.
    output = sessions.groupby('bin', observed=False).agg(
        total=('session_id', 'count') 
    ).reset_index() 
    
    return output 
```


Here is the step-by-step table flowchart with the corresponding Python code for the `create_bar_chart` function.

### **Step 1: Load Input Data**
The `Sessions` table is loaded into memory.

**Python Code:**
```python
# Assuming sessions DataFrame is already loaded as per the function input
# sessions = ...
```

**Table Output (`sessions`):**
| session_id | duration |
| :--- | :--- |
| 1 | 30 |
| 2 | 199 |
| 3 | 299 |
| 4 | 580 |
| 5 | 1000 |

---

### **Step 2: Categorize Duration into Bins**
The duration (in seconds) is converted to minutes (`duration / 60`). The `pd.cut` function is used to assign each session to a specific time interval.
*   **Bins:** `[0, 5, 10, 15, infinity]`
*   **Labels:** `'[0-5>', '[5-10>', '[10-15>', '15 or more'`
*   **Logic:** `right=False` means the interval includes the left edge and excludes the right edge (e.g., 5 minutes falls into the `[5-10>` bin, not `[0-5>`).

**Python Code:**
```python
bins = [0, 5, 10, 15, float('inf')]
labels = ['[0-5>', '[5-10>', '[10-15>', '15 or more']

sessions['bin'] = pd.cut(sessions['duration'] / 60, bins=bins, labels=labels, right=False)
```

**Table Output (`sessions`):**
*(Calculated Minutes: 0.5, 3.32, 4.98, 9.67, 16.67)*
| session_id | duration | **bin** |
| :--- | :--- | :--- |
| 1 | 30 | **[0-5>** |
| 2 | 199 | **[0-5>** |
| 3 | 299 | **[0-5>** |
| 4 | 580 | **[5-10>** |
| 5 | 1000 | **15 or more** |

---

### **Step 3: Aggregate and Count**
The data is grouped by the categorical `bin` column.
*   **Observed=False:** This argument is crucial. It tells Pandas to include **all** categories defined in the `labels` list in the output, even if no sessions fall into that bin (e.g., `[10-15>`).
*   Sessions in each bin are counted.

**Python Code:**
```python
output = sessions.groupby('bin', observed=False).agg(
    total=('session_id', 'count')
).reset_index()
```

**Final Table Output (`output`):**
*(The bin `[10-15>` automatically appears with a count of 0)*
| bin | total |
| :--- | :--- |
| [0-5> | 3 |
| [5-10> | 1 |
| [10-15> | 0 |
| 15 or more | 1 |  


