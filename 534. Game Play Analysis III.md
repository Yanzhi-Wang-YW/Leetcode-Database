```md
534. Game Play Analysis III 
Table: Activity

+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| player_id    | int     |
| device_id    | int     |
| event_date   | date    |
| games_played | int     |
+--------------+---------+
(player_id, event_date) is the primary key (column with unique values) of this table.
This table shows the activity of players of some games.
Each row is a record of a player who logged in and played a number of games (possibly 0) before logging out on someday using some device.
 

Write a solution to report for each player and date, how many games played so far by the player. That is, the total number of games played by the player until that date. Check the example for clarity.

Return the result table in any order.

The result format is in the following example.

 

Example 1:

Input: 
Activity table:
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
| 1         | 2         | 2016-03-01 | 5            |
| 1         | 2         | 2016-05-02 | 6            |
| 1         | 3         | 2017-06-25 | 1            |
| 3         | 1         | 2016-03-02 | 0            |
| 3         | 4         | 2018-07-03 | 5            |
+-----------+-----------+------------+--------------+
Output: 
+-----------+------------+---------------------+
| player_id | event_date | games_played_so_far |
+-----------+------------+---------------------+
| 1         | 2016-03-01 | 5                   |
| 1         | 2016-05-02 | 11                  |
| 1         | 2017-06-25 | 12                  |
| 3         | 2016-03-02 | 0                   |
| 3         | 2018-07-03 | 5                   |
+-----------+------------+---------------------+
Explanation: 
For the player with id 1, 5 + 6 = 11 games played by 2016-05-02, and 5 + 6 + 1 = 12 games played by 2017-06-25.
For the player with id 3, 0 + 5 = 5 games played by 2018-07-03.
Note that for each player we only care about the days when the player logged in
```

```py 
import pandas as pd

def gameplay_analysis(activity: pd.DataFrame) -> pd.DataFrame: 
    output = activity.sort_values(['player_id', 'event_date']) 
    output['games_played_so_far'] = output.groupby('player_id')['games_played'].cumsum() 
    output = output[['player_id', 'event_date', 'games_played_so_far']]     
    return output 
```

Here is the step-by-step table flowchart with the corresponding Python code for the `gameplay_analysis` function.

### **Step 1: Load Input Data**
The `Activity` table is loaded into memory.

**Python Code:**
```python
# Assuming activity DataFrame is already loaded as per the function input
# activity = ...
```

**Table Output (`activity`):**
| player_id | device_id | event_date | games_played |
| :--- | :--- | :--- | :--- |
| 1 | 2 | 2016-03-01 | 5 |
| 1 | 2 | 2016-05-02 | 6 |
| 1 | 3 | 2017-06-25 | 1 |
| 3 | 1 | 2016-03-02 | 0 |
| 3 | 4 | 2018-07-03 | 5 |

---

### **Step 2: Sort Data**
The data is sorted by `player_id` and `event_date` in ascending order. This ensures that the cumulative sum calculation follows the chronological order of events for each player.

**Python Code:**
```python
output = activity.sort_values(['player_id', 'event_date'])
```

**Table Output (`output`):**
| player_id | device_id | event_date | games_played |
| :--- | :--- | :--- | :--- |
| 1 | 2 | 2016-03-01 | 5 |
| 1 | 2 | 2016-05-02 | 6 |
| 1 | 3 | 2017-06-25 | 1 |
| 3 | 1 | 2016-03-02 | 0 |
| 3 | 4 | 2018-07-03 | 5 |

---

### **Step 3: Calculate Cumulative Sum**
A new column `games_played_so_far` is created. It calculates the running total of `games_played` for each `player_id`.

**Python Code:**
```python
output['games_played_so_far'] = output.groupby('player_id')['games_played'].cumsum()
```

**Table Output (`output`):**
*(The running total resets for each new player_id)*

| player_id | device_id | event_date | games_played | **games_played_so_far** |
| :--- | :--- | :--- | :--- | :--- |
| 1 | 2 | 2016-03-01 | 5 | **5** |
| 1 | 2 | 2016-05-02 | 6 | **11** (5+6) |
| 1 | 3 | 2017-06-25 | 1 | **12** (5+6+1) |
| 3 | 1 | 2016-03-02 | 0 | **0** |
| 3 | 4 | 2018-07-03 | 5 | **5** (0+5) |

---

### **Step 4: Select Final Columns**
Only the `player_id`, `event_date`, and the newly calculated `games_played_so_far` columns are selected for the final output.

**Python Code:**
```python
output = output[['player_id', 'event_date', 'games_played_so_far']]
```

**Final Table Output (`output`):**
| player_id | event_date | games_played_so_far |
| :--- | :--- | :--- |
| 1 | 2016-03-01 | 5 |
| 1 | 2016-05-02 | 11 |
| 1 | 2017-06-25 | 12 |
| 3 | 2016-03-02 | 0 |
| 3 | 2018-07-03 | 5 |  
