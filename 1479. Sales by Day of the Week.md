```md
1479. Sales by Day of the Week  
Table: Orders

+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| customer_id   | int     |
| order_date    | date    |
| item_id       | varchar |
| quantity      | int     |
+---------------+---------+
(ordered_id, item_id) is the primary key for this table.
This table contains information of the orders placed.
order_date is the date when item_id was ordered by the customer with id customer_id.
 

Table: Items

+---------------------+---------+
| Column Name         | Type    |
+---------------------+---------+
| item_id             | varchar |
| item_name           | varchar |
| item_category       | varchar |
+---------------------+---------+
item_id is the primary key for this table.
item_name is the name of the item.
item_category is the category of the item.
 

You are the business owner and would like to obtain a sales report for category items and day of the week.

Write an SQL query to report how many units in each category have been ordered on each day of the week.

Return the result table ordered by category.

The query result format is in the following example:

 

Orders table:
+------------+--------------+-------------+--------------+-------------+
| order_id   | customer_id  | order_date  | item_id      | quantity    |
+------------+--------------+-------------+--------------+-------------+
| 1          | 1            | 2020-06-01  | 1            | 10          |
| 2          | 1            | 2020-06-08  | 2            | 10          |
| 3          | 2            | 2020-06-02  | 1            | 5           |
| 4          | 3            | 2020-06-03  | 3            | 5           |
| 5          | 4            | 2020-06-04  | 4            | 1           |
| 6          | 4            | 2020-06-05  | 5            | 5           |
| 7          | 5            | 2020-06-05  | 1            | 10          |
| 8          | 5            | 2020-06-14  | 4            | 5           |
| 9          | 5            | 2020-06-21  | 3            | 5           |
+------------+--------------+-------------+--------------+-------------+

Items table:
+------------+----------------+---------------+
| item_id    | item_name      | item_category |
+------------+----------------+---------------+
| 1          | LC Alg. Book   | Book          |
| 2          | LC DB. Book    | Book          |
| 3          | LC SmarthPhone | Phone         |
| 4          | LC Phone 2020  | Phone         |
| 5          | LC SmartGlass  | Glasses       |
| 6          | LC T-Shirt XL  | T-Shirt       |
+------------+----------------+---------------+

Result table:
+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+
| Category   | Monday    | Tuesday   | Wednesday | Thursday  | Friday    | Saturday  | Sunday    |
+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+
| Book       | 20        | 5         | 0         | 0         | 10        | 0         | 0         |
| Glasses    | 0         | 0         | 0         | 0         | 5         | 0         | 0         |
| Phone      | 0         | 0         | 5         | 1         | 0         | 0         | 10        |
| T-Shirt    | 0         | 0         | 0         | 0         | 0         | 0         | 0         |
+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+
On Monday (2020-06-01, 2020-06-08) were sold a total of 20 units (10 + 10) in the category Book (ids: 1, 2).
On Tuesday (2020-06-02) were sold a total of 5 units  in the category Book (ids: 1, 2).
On Wednesday (2020-06-03) were sold a total of 5 units in the category Phone (ids: 3, 4).
On Thursday (2020-06-04) were sold a total of 1 unit in the category Phone (ids: 3, 4).
On Friday (2020-06-05) were sold 10 units in the category Book (ids: 1, 2) and 5 units in Glasses (ids: 5).
On Saturday there are no items sold.
On Sunday (2020-06-14, 2020-06-21) were sold a total of 10 units (5 +5) in the category Phone (ids: 3, 4).
There are no sales of T-Shirt
``` 

Here is the step-by-step Microsoft Fabric Dataflow Gen2 instructions 
![alt text](/FabricScreenshot/1479_overview.png) 
### Step 1: Load Data 
#### Orders table
| order_id | customer_id | order_date | item_id | quantity |
|:--------:|:-----------:|:----------:|:-------:|:--------:|
| 1        | 1           | 2020-06-01 | 1       | 10       |
| 2        | 1           | 2020-06-08 | 2       | 10       |
| 3        | 2           | 2020-06-02 | 1       | 5        |
| 4        | 3           | 2020-06-03 | 3       | 5        |
| 5        | 4           | 2020-06-04 | 4       | 1        |
| 6        | 4           | 2020-06-05 | 5       | 5        |
| 7        | 5           | 2020-06-05 | 1       | 10       |
| 8        | 5           | 2020-06-14 | 4       | 5        |
| 9        | 5           | 2020-06-21 | 3       | 5        | 

#### Items table 
| item_id |    item_name   | item_category |
|:-------:|:--------------:|:-------------:|
| 1       | LC Alg. Book   | Book          |
| 2       | LC DB. Book    | Book          |
| 3       | LC SmarthPhone | Phone         |
| 4       | LC Phone 2020  | Phone         |
| 5       | LC SmartGlass  | Glasses       |
| 6       | LC T-Shirt XL  | T-Shirt       | 

![alt text](/FabricScreenshot/1479_step1.png) 

### Step 2: The day of the week 
First, the code loads the Orders table, ensures the `order_date` column is a date. Extract the day name 
#### Configuration 
* Click on the `order_date` column to select it.
* Go to the **Transform** tab at the top of the window.
* Click the **Date and Time Column** icon, then select **Date > Day > Name of Day** 

| order_id | customer_id | order_date | item_id | quantity |
|:----------|:-------------|:------------|:---------|:----------|
| 1        | 1           | Monday     | 1       | 10       |
| 2        | 1           | Monday     | 2       | 10       |
| 3        | 2           | Tuesday    | 1       | 5        |
| 4        | 3           | Wednesday  | 3       | 5        |
| 5        | 4           | Thursday   | 4       | 1        |
| 6        | 4           | Friday     | 5       | 5        |
| 7        | 5           | Friday     | 1       | 10       |
| 8        | 5           | Sunday     | 4       | 5        |
| 9        | 5           | Sunday     | 3       | 5        | 

![alt text](/FabricScreenshot/1479_step2.png)  

### Step 3: The Right Outer Join 
It joins the `Orders` table with the `Items` table using `item_id` as the matching key. Because it is a Right Outer Join, it keeps all rows from the right table (`Items`), even if they don't have matching orders in the left table (`Orders`). The matched data from the `Items` table is compressed into a single nested table column called `Items`. Expand `Items` column and extract only the `item_category` column 
#### Configuration
* Go to the **Home** tab and click **Merge Queries as New**. 
* In the top dropdown, ensure your `Orders` table is selected. In the bottom dropdown, select your `Items` table.
* Click on the `item_id` column header in **both** table preview windows to highlight them as the matching keys.
* Under the **Join Kind** dropdown, select **Right Outer** and click **OK**. 
* In your newly merged table, click the **Expand icon** (two diverging arrows) on the new `Items` column header.
* Uncheck **Select All Columns**, check only `item_category`, uncheck **Use original column name as prefix**, and click **OK** 

| order_id | customer_id | order_date | item_id | quantity | item_category |
|:----------|:-------------|:------------|:---------|:----------|:---------------|
| 1        | 1           | Monday     | 1       | 10       | Book          |
| 3        | 2           | Tuesday    | 1       | 5        | Book          |
| 7        | 5           | Friday     | 1       | 10       | Book          |
| 2        | 1           | Monday     | 2       | 10       | Book          |
| 4        | 3           | Wednesday  | 3       | 5        | Phone         |
| 5        | 4           | Thursday   | 4       | 1        | Phone         |
| 6        | 4           | Friday     | 5       | 5        | Glasses       |
| 8        | 5           | Sunday     | 4       | 5        | Phone         |
| 9        | 5           | Sunday     | 3       | 5        | Phone         |
| null     | null        | null       | null    | null     | T-Shirt       | 

![alt text](/FabricScreenshot/1479_step3.png) 

### Step 4: Grouping and Aggregating 
It groups the data by `item_category` and `order_date`. For every unique combination of these two columns, it calculates the sum of the `quantity` column and puts that sum into a brand new column named `total_quantity`. (The `order_id` and `item_id` columns are dropped during this process) 
#### Configuration
* Hold down the **Ctrl** key and click the column headers for `item_category` and `order_date` to select them both.
* Go to the **Transform** tab and click **Group By**.
* Ensure the **Advanced** toggle is selected at the top of the dialog box (this allows multiple grouping columns).
* Confirm that your grouping columns are set to `item_category` and `order_date`.
* Under the **New column name**, type `total_quantity`.
* Under **Operation**, select `Sum`.
* Under **Column**, select `quantity`.
* Click **OK**. 

| item_category | order_date | total_quantity |
|:---------------|:------------|:----------------|
| Book          | Monday     | 20             |
| Book          | Tuesday    | 5              |
| Book          | Friday     | 10             |
| Phone         | Wednesday  | 5              |
| Phone         | Thursday   | 1              |
| Glasses       | Friday     | 5              |
| Phone         | Sunday     | 10             |
| T-Shirt       | null       | null           | 

![alt text](/FabricScreenshot/1479_step4.png) 

### Step 5: Pivoting the Dates into Columns 
First, it ensures `order_date` is formatted as text. Then, it pivots the table: it takes the values inside the `order_date` column and turns them into their own individual columns (Monday through Sunday). The values that fill these new columns are taken from `total_quantity` 
#### Configuration
* Click on the `order_date` column to select it.
* Go to the **Transform** tab and click **Pivot Column**.
* In the dialog box, under **Values Column**, select `total_quantity`.
* Click the **Advanced options** dropdown arrow.
* Ensure the **Aggregate Value Function** is set to `Sum`. 
* Click **OK**. 
* It throws an error. 
* Look at the **Formula Bar** 
* Delete the `List.Distinct(Table.TransformColumnTypes(#"Grouped rows", {{"order_date", type text}})[order_date])` 
* Replace it with `{"Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"}`   

| item_category | Monday | Tuesday | Wednesday | Thursday | Friday | Saturday | Sunday |
|:---------------|:--------|:---------|:-----------|:----------|:--------|:----------|:--------|
| Book          | 20     | 5       | null      | null     | 10     | null     | null   |
| Glasses       | null   | null    | null      | null     | 5      | null     | null   |
| Phone         | null   | null    | 5         | 1        | null   | null     | 10     |
| T-Shirt       | null   | null    | null      | null     | null   | null     | null   | 

![alt text](/FabricScreenshot/1479_step5.png)  

### Step 6: Replacing Nulls with Zeros

It scans through all the newly created day-of-the-week columns. Wherever it finds a `null` (meaning no items were sold in that category on that day), it replaces it with a `0`. This creates a clean, complete matrix that is perfect for reporting and calculations.

#### Configuration
* Select all the day-of-the-week columns. Click on the `Monday` column header, hold down the **Shift** key, and click on the `Sunday` column header to highlight them all.
* Go to the **Transform** tab and click **Replace Values**.
* In the dialog box, under **Value To Find**, type `null` (make sure it is all lowercase).
* Under **Replace With**, type `0`.
* Click **OK**
| item_category | Monday | Tuesday | Wednesday | Thursday | Friday | Saturday | Sunday |
|---------------|--------|---------|-----------|----------|--------|----------|--------|
| Book          | 20     | 5       | 0         | 0        | 10     | 0        | 0      |
| Glasses       | 0      | 0       | 0         | 0        | 5      | 0        | 0      |
| Phone         | 0      | 0       | 5         | 1        | 0      | 0        | 10     |
| T-Shirt       | 0      | 0       | 0         | 0        | 0      | 0        | 0      | 

![alt text](/FabricScreenshot/1479_step6.png)  













