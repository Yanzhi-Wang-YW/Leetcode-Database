```md
1398. Customers Who Bought Products A and B but Not C  
Table: Customers

+---------------------+---------+
| Column Name         | Type    |
+---------------------+---------+
| customer_id         | int     |
| customer_name       | varchar |
+---------------------+---------+
customer_id is the column with unique values for this table.
customer_name is the name of the customer.
 

Table: Orders

+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| customer_id   | int     |
| product_name  | varchar |
+---------------+---------+
order_id is the column with unique values for this table.
customer_id is the id of the customer who bought the product "product_name".
 

Write a solution to report the customer_id and customer_name of customers who bought products "A", "B" but did not buy the product "C" since we want to recommend them to purchase this product.

Return the result table ordered by customer_id.

The result format is in the following example.

 

Example 1:

Input: 
Customers table:
+-------------+---------------+
| customer_id | customer_name |
+-------------+---------------+
| 1           | Daniel        |
| 2           | Diana         |
| 3           | Elizabeth     |
| 4           | Jhon          |
+-------------+---------------+
Orders table:
+------------+--------------+---------------+
| order_id   | customer_id  | product_name  |
+------------+--------------+---------------+
| 10         |     1        |     A         |
| 20         |     1        |     B         |
| 30         |     1        |     D         |
| 40         |     1        |     C         |
| 50         |     2        |     A         |
| 60         |     3        |     A         |
| 70         |     3        |     B         |
| 80         |     3        |     D         |
| 90         |     4        |     C         |
+------------+--------------+---------------+
Output: 
+-------------+---------------+
| customer_id | customer_name |
+-------------+---------------+
| 3           | Elizabeth     |
+-------------+---------------+
Explanation: Only the customer_id with id 3 bought the product A and B but not the product C
```

```py
import pandas as pd

def find_customers(customers: pd.DataFrame, orders: pd.DataFrame) -> pd.DataFrame: 
    orders = orders.groupby('customer_id').agg(
        product_name_list=('product_name', lambda x: list(x)) 
    ).reset_index() 
    orders = orders.loc[orders['product_name_list'].apply(lambda x: 'A' in x and 'B' in x and 'C' not in x)]    
    output = customers.merge(orders, how='inner', on='customer_id') 
    output = output[['customer_id', 'customer_name']] 
    output = output.sort_values(['customer_id'], ascending=[True])     
    return output 
```

 Here is the step-by-step table flowchart with the corresponding Python code for the `find_customers` function.

### **Step 1: Load Input Data**
Two tables are loaded into memory: `Customers` and `Orders`.

**Python Code:**
```python
# Assuming customers and orders DataFrames are already loaded as per the function input
# customers = ...
# orders = ...
```

**Table Outputs:**
**`Customers`**
| customer_id | customer_name |
| :--- | :--- |
| 1 | Daniel |
| 2 | Diana |
| 3 | Elizabeth |
| 4 | Jhon |

**`Orders`**
| order_id | customer_id | product_name |
| :--- | :--- | :--- |
| 10 | 1 | A |
| 20 | 1 | B |
| 30 | 1 | D |
| 40 | 1 | C |
| 50 | 2 | A |
| 60 | 3 | A |
| 70 | 3 | B |
| 80 | 3 | D |
| 90 | 4 | C |

---

### **Step 2: Group Orders and Aggregate Products**
The `orders` table is grouped by `customer_id`. All products purchased by each customer are aggregated into a list in a new column `product_name_list`.

**Python Code:**
```python
orders = orders.groupby('customer_id').agg(
    product_name_list=('product_name', lambda x: list(x))
).reset_index()
```

**Table Output (`orders`):**
| customer_id | product_name_list |
| :--- | :--- |
| 1 | ['A', 'B', 'D', 'C'] |
| 2 | ['A'] |
| 3 | ['A', 'B', 'D'] |
| 4 | ['C'] |

---

### **Step 3: Filter Customer List**
The table is filtered to keep only customers who meet the specific criteria:
1.  Bought product **'A'**.
2.  Bought product **'B'**.
3.  Did **NOT** buy product **'C'**.

*   **Customer 1**: Has 'A' and 'B', but also has 'C'. (Filtered out)
*   **Customer 2**: Has 'A', but missing 'B'. (Filtered out)
*   **Customer 3**: Has 'A', 'B', and does not have 'C'. (Kept)
*   **Customer 4**: Missing 'A' and 'B'. (Filtered out)

**Python Code:**
```python
orders = orders.loc[orders['product_name_list'].apply(lambda x: 'A' in x and 'B' in x and 'C' not in x)]
```

**Table Output (`orders`):**
| customer_id | product_name_list |
| :--- | :--- |
| 3 | ['A', 'B', 'D'] |

---

### **Step 4: Join with Customers Table**
The filtered orders list is joined with the `customers` table using an inner join to retrieve the names of the matching customers.

**Python Code:**
```python
output = customers.merge(orders, how='inner', on='customer_id')
```

**Table Output (`output`):**
| customer_id | customer_name | product_name_list |
| :--- | :--- | :--- |
| 3 | Elizabeth | ['A', 'B', 'D'] |

---

### **Step 5: Select and Sort Columns**
Only the `customer_id` and `customer_name` columns are selected. The results are sorted by `customer_id` in ascending order.

**Python Code:**
```python
output = output[['customer_id', 'customer_name']]
output = output.sort_values(['customer_id'], ascending=[True])
```

**Final Table Output (`output`):**
| customer_id | customer_name |
| :--- | :--- |
| 3 | Elizabeth | 
